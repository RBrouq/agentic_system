<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Résultat - Essay Agent</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
      body { font-family: Arial, sans-serif; margin: 30px; background: #f9f9f9; }
      .container { max-width: 900px; margin: auto; }
      h1, h2 { color: #333; }
      .card {
        background: #fff;
        padding: 20px;
        margin: 15px 0;
        border-radius: 10px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      }
      pre {
        background: #f0f4ff;
        padding: 10px;
        border-radius: 5px;
        overflow: auto;
        white-space: pre-wrap;
      }
      button { padding: 10px 16px; margin: 8px 0; cursor: pointer; border: none; border-radius: 5px; background: #4a90e2; color: white; }
      button:hover { background: #357ab8; }
      input[type=text], select, textarea {
        width: 100%; padding: 8px; margin: 6px 0; border-radius: 5px; border: 1px solid #ccc;
      }
      footer { margin-top: 40px; font-size: 0.9em; color: #666; }
      a { color: #4a90e2; text-decoration: none; }
      a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Résultat pour : {{ topic }}</h1>

      <div class="card">
        <h2>Analyse</h2>
        <p>{{ analysis }}</p>
      </div>

      <div class="card">
        <h2>Plan</h2>
        <pre>{{ plan }}</pre>
      </div>

      <div class="card">
        <h2>Essai généré</h2>
        <pre style="white-space: pre-wrap;">{{ draft }}</pre>
      </div>

      <div class="card">
        <h2>Critique</h2>
        {% if critique.raw %}
          <pre>{{ critique.raw }}</pre>
        {% else %}
          <p><strong>Score :</strong> {{ critique.score }}/100</p>
          <p><strong>Besoin de révision :</strong> {{ 'Oui' if critique.needs_revision else 'Non' }}</p>
          <p><strong>Suggestions :</strong></p>
          <pre>{{ critique.suggested_changes }}</pre>
        {% endif %}
      </div>

      {% if sources %}
      <div class="card">
        <h2>Bibliographie / Sources</h2>
        <ol>
          {% for s in sources %}
            <li>
              {{ s.title }} - <a href="{{ s.url }}" target="_blank">{{ s.url }}</a>
              {% if s.snippet %}<br><em>{{ s.snippet }}</em>{% endif %}
            </li>
          {% endfor %}
        </ol>
      </div>
      {% endif %}

      <div class="card">
        <h2>Validation humaine / Ajustements</h2>
        <form action="/finalize" method="post">
          <input type="hidden" name="topic" value="{{ topic }}">
          <input type="hidden" name="plan" value="{{ plan }}">
          <textarea name="draft" style="display:none;">{{ draft }}</textarea>
          <label>Indiquez vos suggestions ou corrections :</label>
          <textarea name="hints" rows="5" placeholder="Exemple : raccourcir l'introduction, ajouter une source..."></textarea>
          <button type="submit">Appliquer et générer version finale</button>
        </form>
      </div>

      <div class="card">
        <h2>Téléchargements</h2>
        <form action="/download/docx" method="post">
          <input type="hidden" name="topic" value="{{ topic }}">
          <textarea name="content" style="display:none;">{{ draft }}</textarea>
          <button type="submit">Télécharger DOCX</button>
        </form>

        <form action="/download/pdf" method="post">
          <input type="hidden" name="topic" value="{{ topic }}">
          <textarea name="content" style="display:none;">{{ draft }}</textarea>
          <button type="submit">Télécharge





